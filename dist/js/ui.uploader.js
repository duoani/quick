+function(e,t){var i=0,n={},r={STATE_STOPPED:1,STATE_STARTED:2,STATE_QUEUED:1,STATE_UPLOADING:2,STATE_FAILED:4,STATE_DONE:5,ERROR_GENERIC:-100,ERROR_HTTP:-200,ERROR_IO:-300,ERROR_SECURITY:-400,ERROR_INIT:-500,ERROR_FILE_SIZE:-600,ERROR_FILE_EXTENSION:-601,ERROR_FILE_COUNT:-602,ERROR_IMAGE_FORMAT:-700,ERROR_IMAGE_MEMORY:-701,ERROR_IMAGE_DIMENSIONS:-702,EVENT_INIT:"init",EVENT_INIT_AFTER:"init-after",EVENT_FILES_ADD:"files-add",EVENT_FILES_REMOVE:"files-remove",EVENT_FILES_UPLOAD_COMPLETE:"files-upload-complete",EVENT_FILE_UPLOAD_BEFORE:"file-upload-before",EVENT_FILE_UPLOAD_START:"file-upload-start",EVENT_FILE_UPLOAD_PROGRESS:"file-upload-progress",EVENT_FILE_UPLOAD_COMPLETE:"file-upload-complete",EVENT_FILE_UPLOAD_CANCEL:"file-upload-cancel",EVENT_FILE_UPLOAD_CHUNK:"file-chunk-uploaded",EVENT_QUEUE_CHANGE:"queue-change",EVENT_START:"start",EVENT_STOP:"stop",EVENT_REFRESH:"refresh",EVENT_BROWSE_DISABLE:"browse-disable",EVENT_DISPOSE:"dispose",EVENT_ERROR:"error",runtimes:[],guidPrefix:"p",guid:function(){for(var e=(new Date).getTime().toString(32),t=0;5>t;t++)e+=Math.floor(65535*Math.random()).toString(32);return r.guidPrefix+e+(i++).toString(32)},addRuntime:function(e,t){return t.name=e,r.runtimes[e]=t,r.runtimes.push(t),t},ua:function(){var t,i,n,r=navigator,o=r.userAgent,a=r.vendor;return t=/WebKit/.test(o),n=t&&-1!==a.indexOf("Apple"),i=e.opera&&e.opera.buildNumber,{windows:-1!==navigator.platform.indexOf("Win"),ie:!t&&!i&&/MSIE/gi.test(o)&&/Explorer/gi.test(r.appName),webkit:t,gecko:!t&&/Gecko/.test(o),safari:n,opera:!!i}}(),mimeTypes:function(e){var t,i,n,r={},o=e.split(/,/);for(t=0;t<o.length;t+=2)for(n=o[t+1].split(/ /),i=0;i<n.length;i++)r[n[i]]=o[t];return r}("application/msword,doc dot,application/pdf,pdf,application/pgp-signature,pgp,application/postscript,ps ai eps,application/rtf,rtf,application/vnd.ms-excel,xls xlb,application/vnd.ms-powerpoint,ppt pps pot,application/zip,zip,application/x-shockwave-flash,swf swfl,application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,application/vnd.openxmlformats-officedocument.presentationml.template,potx,application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,application/x-javascript,js,application/json,json,audio/mpeg,mpga mpega mp2 mp3,audio/x-wav,wav,audio/mp4,m4a,image/bmp,bmp,image/gif,gif,image/jpeg,jpeg jpg jpe,image/photoshop,psd,image/png,png,image/svg+xml,svg svgz,image/tiff,tiff tif,text/plain,asc txt text diff log,text/html,htm html xhtml,text/css,css,text/csv,csv,text/rtf,rtf,video/mpeg,mpeg mpg mpe,video/quicktime,qt mov,video/mp4,mp4,video/x-m4v,m4v,video/x-flv,flv,video/x-ms-wmv,wmv,video/avi,avi,video/webm,webm,video/vnd.rn-realvideo,rv,application/vnd.oasis.opendocument.formula-template,otf,application/octet-stream,exe"),buildUrl:function(e,t){var i="";return $.each(t,function(e,t){i+=(i?"&":"")+encodeURIComponent(e)+"="+encodeURIComponent(t)}),i&&(e+=(e.indexOf("?")>0?"&":"?")+i),e},addI18n:function(e){return $.extend(n,e)},translate:function(e){return n[e]||e}},o=function(e){this._map={},this.options=$.extend({trigger:null,dropElement:"",className:"",url:"/",file_data_name:"file",multipart_params:{},headers:[],multi_selection:!0,multipart:!0,filters:[],unique_names:"",chunk_size:0,max_file_size:4e6,max_file_count:0,required_features:"",runtimes:"",init:!1},e),this.progress=new u,this.files=[],this.id=r.guid(),this.state=r.STATE_STOPPED,this.runtime="",this.features={},this.timestamp=0,this.disabled=!1};o.prototype={init:function(){function e(){var t,s,u=o[a++];if(u){if(t=u.getFeatures(),s=n.required_features){s=s.split(",");for(var l=0,f=s.length;f>l;l++)if(!t[s[l]])return void e()}u.init(i,function(n){n&&n.success?(i.features=t,i.runtime=u.name,i.trigger(r.EVENT_INIT,{runtime:u.name}),i.trigger(r.EVENT_INIT_AFTER),i.refresh()):e()})}else i.trigger(r.EVENT_ERROR,{code:r.ERROR_INIT,message:r.translate("Init error.")})}var i=this,n=this.options;this.on(r.EVENT_FILES_ADD,function(e,i){var o,a,s=n.filters,u=0;s&&s.length&&(a=[],$.each(s,function(e,t){$.each(t.extensions.split(/,/),function(e,t){a.push(/^\s*\*\s*$/.test(t)?"\\.*":"\\."+t.replace(new RegExp("["+"/^$.*+?|()[]{}\\".replace(/./g,"\\$&")+"]","g"),"\\$&"))})}),a=new RegExp(a.join("|")+"$","i"));for(var l=0;l<i.length;l++)if(o=i[l],o.loaded=0,o.percent=0,o.status=r.STATE_QUEUED,!a||a.test(o.name))if(o.size!==t&&o.size>n.max_file_size)e.trigger(r.EVENT_ERROR,{code:r.ERROR_FILE_SIZE,message:r.translate("File size error."),file:o});else{if(n.max_file_count&&e.files.length>=n.max_file_count){e.trigger(r.EVENT_ERROR,{code:r.ERROR_FILE_COUNT,message:r.translate("File count error."),file:o});break}e.files.push(o),u++}else e.trigger(r.EVENT_ERROR,{code:r.ERROR_FILE_EXTENSION,message:r.translate("File extension error."),file:o});u&&setTimeout(function(){e.trigger(r.EVENT_QUEUE_CHANGE),e.refresh()},1)}),n.unique_names&&i.on(r.EVENT_FILE_UPLOAD_START,function(e,t){var i=t.name.match(/\.([^.]+)$/),n="tmp";i&&(n=i[1]),t.target_name=t.id+"."+n}),i.on(r.EVENT_FILE_UPLOAD_PROGRESS,function(e,t){t.percent=t.size>0?Math.ceil(t.loaded/t.size*100):100,e._updateProgress()}),i.on(r.EVENT_QUEUE_CHANGE,function(e){e._updateProgress(),e.start()}),i.on(r.EVENT_ERROR,function(e,t){t.file&&(t.file.status=r.STATE_FAILED,e._updateProgress(),e.state==r.STATE_STARTED&&setTimeout(function(){e._queueUpload.call(e)},1))}),i.on(r.EVENT_FILE_UPLOAD_COMPLETE,function(e,t){t.status=r.STATE_DONE,t.loaded=t.size,e.trigger(r.EVENT_FILE_UPLOAD_PROGRESS,t),setTimeout(function(){e._queueUpload()},1)});var o=[],a=0;if(n.runtimes)for(var s=n.runtimes.split(/\s?,\s?/),u=0,l=s.length;l>u;u++)r.runtimes[s[u]]&&o.push(r.runtimes[s[u]]);else o=r.runtimes;e(),n.init&&("function"==typeof n.init?n.init(i):$.each(n.init,function(e,t){i.on(e,t)}))},trigger:function(e){var t,i=Array.prototype.slice.call(arguments,0);i[0]=this;var n,r;if(n=this._map[e]){for(var o=[],a=0,s=n.length;s>a;a++)r=n[a],t=r.func.apply(r.scope,i),r.once&&o.push(r.func);if(o.length)for(a=0,s=o.length;s>a;a++)this.off(e,o[a])}return t!==!1},on:function(e,t,i,n){if("function"!=typeof t)return this;var r;return(r=this._map[e])||(this._map[e]=r=[]),r.push({func:t,scope:i||this,once:!!n}),this},once:function(e,t,i){return"function"!=typeof t?this:this.on(e,t,i,!0)},off:function(e,t){var i,n=-1;if(e)if(t){i=this._map[e];for(var r=0,o=i.length;o>r;r++)i[r].func===t&&(n=r);n>=0&&i.splice(n,1)}else this._map[e]=[];else this._map={};return this},_queueUpload:function(){var e,t=0;if(this.state==r.STATE_STARTED){for(var i=0,n=this.files.length;n>i;i++)e||this.files[i].status!=r.STATE_QUEUED?t++:(e=this.files[i],e.status=r.STATE_UPLOADING,this.trigger(r.EVENT_FILE_UPLOAD_BEFORE,e)&&this.trigger(r.EVENT_FILE_UPLOAD_START,e));t==this.files.length&&(this.stop(),this.trigger(r.EVENT_FILES_UPLOAD_COMPLETE,this.files))}},_updateProgress:function(){var e;this.progress.reset();for(var i=0,n=this.files.length;n>i;i++)e=this.files[i],e.size!==t?(this.progress.size+=e.size,this.progress.loaded+=e.loaded):this.progress.size=t,e.status==r.STATE_DONE?this.progress.uploaded++:e.status==r.STATE_FAILED?this.progress.failed++:this.progress.queued++;this.progress.size===t?this.progress.percent=this.files.length>0?Math.ceil(this.progress.uploaded/this.files.length*100):0:(this.progress.bytesPerSec=Math.ceil(this.progress.loaded/((+new Date-this.timestamp||1)/1e3)),this.progress.percent=this.progress.size>0?Math.ceil(this.progress.loaded/this.progress.size*100):0)},refresh:function(){this.trigger(r.EVENT_REFRESH)},start:function(){this.files.length&&this.state!=r.STATE_STARTED&&(this.state=r.STATE_STARTED,this.timestamp=+new Date,this.trigger(r.EVENT_START),this._queueUpload())},stop:function(){if(this.state!=r.STATE_STOPPED){this.state=r.STATE_STOPPED;for(var e=this.files.length-1;e>=0;e--)this.files[e].status==r.STATE_UPLOADING&&(this.files[e].status=r.STATE_QUEUED,this._updateProgress());this.trigger(r.EVENT_FILE_UPLOAD_CANCEL),this.trigger(r.EVENT_STOP)}},disableBrowse:function(){this.disabled=arguments[0]!==t?arguments[0]:!0,this.trigger(r.EVENT_BROWSE_DISABLE,this.disabled)},getFile:function(e){for(var t,i=this.files.length-1;t=this.files[i--];)if(t.id===e)return t},removeFile:function(e){for(var t=this.files.length-1;t>=0;t--)if(this.files[t].id===e)return this.splice(t,1)[0]},splice:function(e,i){var n=this.files.splice(e===t?0:e,i===t?this.files.length:i);return this.trigger(r.EVENT_FILES_REMOVE,n),this.trigger(r.EVENT_QUEUE_CHANGE),n},dispose:function(){this.stop(),this.trigger(r.EVENT_DISPOSE),this.off(),this.supr()}};var a=function(e,t,i){this.id=e,this.name=t,this.size=i,this.loaded=0,this.percent=0,this.status=0},s={getFeatures:function(){},init:function(){}},u=function(){var e=this;e.size=0,e.loaded=0,e.uploaded=0,e.failed=0,e.queued=0,e.percent=0,e.bytesPerSec=0,e.reset=function(){e.size=e.loaded=e.uploaded=e.failed=e.queued=e.percent=e.bytesPerSec=0}};r.File=a,r.Uploader=o,r.Runtime=s,e.lupload=r}(window),+function(e,t,i,n){function r(t,i){var n;return"FileReader"in e?(n=new FileReader,n.readAsDataURL(t),void(n.onload=function(){i(n.result)})):i(t.getAsDataURL())}function o(t,i){var n;return"FileReader"in e?(n=new FileReader,n.readAsBinaryString(t),void(n.onload=function(){i(n.result)})):i(t.getAsBinary())}function a(e,i,n,o){var a,s,f,d;r(p[e.id],function(e){a=t.createElement("canvas"),a.style.display="none",t.body.appendChild(a),s=a.getContext("2d"),f=new Image,f.onerror=f.onabort=function(){o({success:!1})},f.onload=function(){var t,r,p,c;if(i.width||(i.width=f.width),i.height||(i.height=f.height),d=Math.min(i.width/f.width,i.height/f.height),1>d||1===d&&"image/jpeg"===n){if(t=Math.round(f.width*d),r=Math.round(f.height*d),a.width=t,a.height=r,s.drawImage(f,0,0,t,r),"image/jpeg"===n){if(p=new u(atob(e.substring(e.indexOf("base64,")+7))),p.headers&&p.headers.length&&(c=new l,c.init(p.get("exif")[0])&&(c.setExif("PixelXDimension",t),c.setExif("PixelYDimension",r),p.set("exif",c.getBinary()))),i.quality)try{e=a.toDataURL(n,i.quality/100)}catch(E){e=a.toDataURL(n)}}else e=a.toDataURL(n);e=e.substring(e.indexOf("base64,")+7),e=atob(e),p&&p.headers&&p.headers.length&&(e=p.restore(e),p.purge()),a.parentNode.removeChild(a),o({success:!0,data:e})}else o({success:!1})},f.src=e})}function s(){function e(e,t){var i,n=o?0:-8*(t-1),a=0;for(i=0;t>i;i++)a|=r.charCodeAt(e+i)<<Math.abs(n+8*i);return a}function t(e,t,i){var i=3===arguments.length?i:r.length-t-1;r=r.substr(0,t)+e+r.substr(i+t)}function i(e,i,n){var r,a="",s=o?0:-8*(n-1);for(r=0;n>r;r++)a+=String.fromCharCode(i>>Math.abs(s+8*r)&255);t(a,e,n)}var r,o=!1;return{II:function(e){return e===n?o:void(o=e)},init:function(e){o=!1,r=e},SEGMENT:function(e,i,n){switch(arguments.length){case 1:return r.substr(e,r.length-e-1);case 2:return r.substr(e,i);case 3:t(n,e,i);break;default:return r}},BYTE:function(t){return e(t,1)},SHORT:function(t){return e(t,2)},LONG:function(t,r){return r===n?e(t,4):void i(t,r,4)},SLONG:function(t){var i=e(t,4);return i>2147483647?i-4294967296:i},STRING:function(t,i){var n="";for(i+=t;i>t;t++)n+=String.fromCharCode(e(t,1));return n}}}function u(e){var t,i,r,o={65505:{app:"EXIF",name:"APP1",signature:"Exif\x00"},65506:{app:"ICC",name:"APP2",signature:"ICC_PROFILE\x00"},65517:{app:"IPTC",name:"APP13",signature:"Photoshop 3.0\x00"}},a=[],l=n,f=0;if(t=new s,t.init(e),65496===t.SHORT(0)){for(i=2,r=Math.min(1048576,e.length);r>=i;)if(l=t.SHORT(i),l>=65488&&65495>=l)i+=2;else{if(65498===l||65497===l)break;f=t.SHORT(i+2)+2,o[l]&&t.STRING(i+4,o[l].signature.length)===o[l].signature&&a.push({hex:l,app:o[l].app.toUpperCase(),name:o[l].name.toUpperCase(),start:i,length:f,segment:t.SEGMENT(i,f)}),i+=f}return t.init(null),{headers:a,restore:function(e){t.init(e);var n=new u(e);if(!n.headers)return!1;for(var r=n.headers.length;r>0;r--){var o=n.headers[r-1];t.SEGMENT(o.start,o.length,"")}n.purge(),i=65504==t.SHORT(2)?4+t.SHORT(4):2;for(var r=0,s=a.length;s>r;r++)t.SEGMENT(i,0,a[r].segment),i+=a[r].length;return t.SEGMENT()},get:function(e){for(var t=[],i=0,n=a.length;n>i;i++)a[i].app===e.toUpperCase()&&t.push(a[i].segment);return t},set:function(e,t){var i=[];"string"==typeof t?i.push(t):i=t;for(var n=0,r=0,o=a.length;o>n&&(a[n].app===e.toUpperCase()&&(a[n].segment=i[r],a[n].length=i[r].length,r++),!(r>=i.length));n++);},purge:function(){a=[],t.init(null)}}}}function l(){function e(e,t){var i,o,s,l,f,p,d,c,E=r.SHORT(e),h=[],g={};for(i=0;E>i;i++)if(d=p=e+12*i+2,s=t[r.SHORT(d)],s!==n){switch(l=r.SHORT(d+=2),f=r.LONG(d+=2),d+=4,h=[],l){case 1:case 7:for(f>4&&(d=r.LONG(d)+u.tiffHeader),o=0;f>o;o++)h[o]=r.BYTE(d+o);break;case 2:f>4&&(d=r.LONG(d)+u.tiffHeader),g[s]=r.STRING(d,f-1);continue;case 3:for(f>2&&(d=r.LONG(d)+u.tiffHeader),o=0;f>o;o++)h[o]=r.SHORT(d+2*o);break;case 4:for(f>1&&(d=r.LONG(d)+u.tiffHeader),o=0;f>o;o++)h[o]=r.LONG(d+4*o);break;case 5:for(d=r.LONG(d)+u.tiffHeader,o=0;f>o;o++)h[o]=r.LONG(d+4*o)/r.LONG(d+4*o+4);break;case 9:for(d=r.LONG(d)+u.tiffHeader,o=0;f>o;o++)h[o]=r.SLONG(d+4*o);break;case 10:for(d=r.LONG(d)+u.tiffHeader,o=0;f>o;o++)h[o]=r.SLONG(d+4*o)/r.SLONG(d+4*o+4);break;default:continue}c=1==f?h[0]:h,g[s]=a.hasOwnProperty(s)&&"object"!=typeof c?a[s][c]:c}return g}function t(){var t=n,i=u.tiffHeader;return r.II(18761==r.SHORT(i)),42!==r.SHORT(i+=2)?!1:(u.IFD0=u.tiffHeader+r.LONG(i+=2),t=e(u.IFD0,o.tiff),u.exifIFD="ExifIFDPointer"in t?u.tiffHeader+t.ExifIFDPointer:n,u.gpsIFD="GPSInfoIFDPointer"in t?u.tiffHeader+t.GPSInfoIFDPointer:n,!0)}function i(e,t,i){var n,a,s,l,f=0;if("string"==typeof t){var p=o[e.toLowerCase()];for(var d in p)if(p[d]===t){t=d;break}}for(a=u[e.toLowerCase()+"IFD"],s=r.SHORT(a),n=0;s>n;n++)if(l=a+12*n+2,r.SHORT(l)==t){f=l+8;break}return f?(r.LONG(f,i),!0):!1}var r,o,a,u={};return r=new s,o={tiff:{274:"Orientation",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"}},a={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire.",1:"Flash fired.",5:"Strobe return light not detected.",7:"Strobe return light detected.",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}},{init:function(e){return u={tiffHeader:10},e!==n&&e.length?(r.init(e),65505===r.SHORT(0)&&"EXIF\x00"===r.STRING(4,5).toUpperCase()?t():!1):!1},EXIF:function(){var t;if(t=e(u.exifIFD,o.exif),t.ExifVersion&&"array"===c.typeOf(t.ExifVersion)){for(var i=0,n="";i<t.ExifVersion.length;i++)n+=String.fromCharCode(t.ExifVersion[i]);t.ExifVersion=n}return t},GPS:function(){var t;return t=e(u.gpsIFD,o.gps),t.GPSVersionID&&(t.GPSVersionID=t.GPSVersionID.join(".")),t},setExif:function(e,t){return"PixelXDimension"!==e&&"PixelYDimension"!==e?!1:i("exif",e,t)},getBinary:function(){return r.SEGMENT()}}}var f,p={};i.runtimes.Html5=i.addRuntime("html5",{getFeatures:function(){var n,r,o,a,s,u;return r=o=s=u=!1,e.XMLHttpRequest&&(n=new XMLHttpRequest,o=!!n.upload,r=!(!n.sendAsBinary&&!n.upload)),r&&(a=!!(n.sendAsBinary||e.Uint8Array&&e.ArrayBuffer),s=!(!File||!File.prototype.getAsDataURL&&!e.FileReader||!a),u=!(!File||!(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice))),f=i.ua.safari&&i.ua.windows,{html5:r,dragdrop:function(){var e=t.createElement("div");return"draggable"in e||"ondragstart"in e&&"ondrop"in e}(),jpgresize:s,pngresize:s,multipart:s||!!e.FileReader||!!e.FormData,canSendBinary:a,cantSendBlobInFormData:!(!(i.ua.gecko&&e.FormData&&e.FileReader)||FileReader.prototype.readAsArrayBuffer),progress:o,chunks:u,multi_selection:!(i.ua.safari&&i.ua.windows),triggerDialog:i.ua.gecko&&e.FormData||i.ua.webkit}},init:function(n,r){function s(e){return e+"."+n.id}function u(e){for(var t,r,o=[],a={},s=0,u=e.length;u>s;s++)t=e[s],a[t.name]||(a[t.name]=!0,r=i.guid(),p[r]=t,o.push(new i.File(r,t.fileName||t.name,t.fileSize||t.size)));o.length&&n.trigger(i.EVENT_FILES_ADD,o)}var l,d;l=this.getFeatures(),l.html5?(n.on(i.EVENT_INIT,function(e){var n,r,o,a,l,f,p,d=[],c=e.options,E=e.options.filters,h=$(t.body);n=$('<div id="'+e.id+'_html5_container" />'),c.className&&n.addClass(c.className),n.css({position:"absolute",background:"transparent",overflow:"hidden",top:0,left:0,width:"100%",height:"100%",opacity:0}),n.addClass("lupload html5"),c.container&&(h=$(c.container),"static"===h.css("position")&&h.css("position","relative")),h.append(n);e:for(o=0;o<E.length;o++)for(l=E[o].extensions.split(/,/),a=0;a<l.length;a++){if("*"===l[a]){d=[];break e}f=i.mimeTypes[l[a]],f&&-1===$.inArray(f,d)&&d.push(f)}p=$('<input id="'+e.id+'_html5"  style="font-size:999px" type="file" accept="'+d.join(",")+'" '+(e.options.multi_selection&&e.features.multi_selection?'multiple="multiple"':"")+" />").appendTo(n.scrollTop(100)),e.features.triggerDialog?p.css({position:"absolute",left:0,width:"100%",height:"100%"}):p.css("float","right"),p.on("change",function(){u(this.files),$(this).val("")}),r=$(c.trigger),r.size()&&e.features.triggerDialog&&r.on(s("click"),function(t){var i=$("#"+e.id+"_html5");i.size()&&!i.is(":disabled")&&i.trigger("click"),t.preventDefault()})}),n.on(i.EVENT_INIT_AFTER,function(){var e=$(n.options.dropElement);if(e.size()){if(f)return void e.on(s("dragenter"),function(){var t;t=$("#"+n.id+"_drop"),t.size()||(t=$('<input type="file" id="'+n.id+'_drop" '+(n.options.multi_selection&&n.features.multi_selection?'multiple="multiple"':"")+" />"),t.on(s("change"),function(){u(this.files),t.off(s("change")),t.remove()}),e.append(t)),"static"===e.css("position")&&e.css({position:"relative"}),t.css({position:"absolute",display:"block",top:0,left:0,width:(e[0].offsetWidth||e[0].clientWidth)+"px",height:(e[0].offsetHeight||e[0].clientHeight)+"px",opacity:0})});e.on(s("dragover"),function(e){e.preventDefault()}),e.on(s("drop"),function(e){var t=e.originalEvent.dataTransfer;t&&t.files&&u(t.files),e.preventDefault()})}}),n.on(i.EVENT_REFRESH,function(e){}),n.on(i.EVENT_BROWSE_DISABLE,function(e,t){var i=$("#"+e.id+"_html5");i.size()&&i.prop("disabled",t)}),n.on(i.EVENT_FILE_UPLOAD_CANCEL,function(){d&&d.abort&&d.abort()}),n.on(i.EVENT_FILE_UPLOAD_START,function(t,n){function r(e,t,i){var n;if(!File.prototype.slice)return(n=File.prototype.webkitSlice||File.prototype.mozSlice)?n.call(e,t,i):null;try{return e.slice(),e.slice(t,i)}catch(r){return e.slice(t,i-t)}}function s(o){function a(){function c(r){var o,u=0,p="----luploadboundary"+i.guid(),c="--",R="\r\n",v="";if(d=new XMLHttpRequest,d.upload&&(d.upload.onprogress=function(e){n.loaded=Math.min(n.size,f+e.loaded-u),t.trigger(i.EVENT_FILE_UPLOAD_PROGRESS,n)}),d.onreadystatechange=function(){var e,r;if(4==d.readyState&&t.state!==i.STATE_STOPPED){try{e=d.status}catch(u){e=0}if(e>=400)t.trigger(i.EVENT_ERROR,{code:i.ERROR_HTTP,message:i.translate("HTTP Error."),file:n,status:e});else{if(h){if(r={chunk:s,chunks:h,response:d.responseText,status:e,canceled:!1},t.trigger(i.EVENT_FILE_UPLOAD_CHUNK,n,r),f+=_,r.canceled)return void(n.status=i.STATE_FAILED);n.loaded=Math.min(n.size,(s+1)*m)}else n.loaded=n.size;if(t.trigger(i.EVENT_FILE_UPLOAD_PROGRESS,n),u=E=o=v=null,!h||++s>=h){n.status=i.STATE_DONE;var l=d.responseText;try{l=$.parseJSON(l)}catch(u){}t.trigger(i.EVENT_FILE_UPLOAD_COMPLETE,n,l)}else a()}}},t.options.multipart&&l.multipart){if(g.name=n.target_name||n.name,d.open("post",S,!0),$.each(t.options.headers,function(e,t){d.setRequestHeader(e,t)}),"string"!=typeof r&&e.FormData)return o=new FormData,$.each($.extend(g,t.options.multipart_params),function(e,t){o.append(e,t)}),o.append(t.options.file_data_name,r),void d.send(o);if("string"==typeof r){if(d.setRequestHeader("Content-Type","multipart/form-data; boundary="+p),$.each($.extend(g,t.options.multipart_params),function(e,t){v+=c+p+R+'Content-Disposition: form-data; name="'+e+'"'+R+R,v+=unescape(encodeURIComponent(t))+R}),T=i.mimeTypes[n.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream",v+=c+p+R+'Content-Disposition: form-data; name="'+t.options.file_data_name+'"; filename="'+unescape(encodeURIComponent(n.name))+'"'+R+"Content-Type: "+T+R+R+r+R+c+p+c+R,u=v.length-r.length,r=v,d.sendAsBinary)d.sendAsBinary(r);else if(l.canSendBinary){for(var O=new Uint8Array(r.length),N=0;N<r.length;N++)O[N]=255&r.charCodeAt(N);d.send(O.buffer)}return}}S=i.buildUrl(t.options.url,$.extend(g,t.options.multipart_params)),d.open("post",S,!0),d.setRequestHeader("Content-Type","application/octet-stream"),$.each(t.options.headers,function(e,t){d.setRequestHeader(e,t)}),d.send(r)}var E,h,g,m,_,T,S=t.options.url;n.status!=i.STATE_DONE&&n.status!=i.STATE_FAILED&&t.state!=i.STATE_STOPPED&&(g={name:n.target_name||n.name},u.chunk_size&&n.size>u.chunk_size&&(l.chunks||"string"==typeof o)?(m=u.chunk_size,h=Math.ceil(n.size/m),_=Math.min(m,n.size-s*m),E="string"==typeof o?o.substring(s*m,s*m+_):r(o,s*m,s*m+_),g.chunk=s,g.chunks=h):(_=n.size,E=o),t.options.multipart&&l.multipart&&"string"!=typeof E&&p&&l.cantSendBlobInFormData&&l.chunks&&t.options.chunk_size?(p.onload=function(){c(p.result)},p.readAsBinaryString(E)):c(E))}var s=0,f=0,p="FileReader"in e?new FileReader:null;a()}var u=t.options,f=p[n.id];l.jpgresize&&t.options.resize&&/\.(png|jpg|jpeg)$/i.test(n.name)?a.call(t,n,t.options.resize,/\.png$/i.test(n.name)?"image/png":"image/jpeg",function(e){e.success?(n.size=e.data.length,s(e.data)):l.chunks?s(f):o(f,s)}):!l.chunks&&l.jpgresize?o(f,s):s(f)}),n.on(i.EVENT_DISPOSE,function(e){var i,n,r={inputContainer:"#"+e.id+"_html5_container",inputFile:"#"+e.id+"_html5",browseButton:e.options.trigger,dropElm:e.options.dropElement};for(i in r)n=$(r[i]),n.size()&&n.off("."+e.id);$(t.body).off("."+e.id),$(r.inputContainer).remove()}),r({success:!0})):r({success:!1})}})}(window,document,lupload),+function(e,t,i){i.runtimes.Html4=i.addRuntime("html4",{getFeatures:function(){return{multipart:!0,triggerDialog:i.ua.gecko&&e.FormData||i.ua.webkit}},init:function(e,n){e.on(i.EVENT_INIT,function(){function n(){var t,r,o;s=i.guid(),p.push(s),t=$("<form />"),t.attr({id:"form_"+s,method:"post",enctype:"multipart/form-data",encoding:"multipart/form-data",target:e.id+"_iframe"}),t.css("position","absolute"),r=$("<input />"),r.attr({id:"input_"+s,type:"file",accept:c,size:1}),o=$(e.options.trigger),e.features.triggerDialog&&o.size()&&o.on(h("click"),function(e){return $(this).is(":disabled")||r.trigger("click"),e.preventDefault(),!1}),r.css({width:"100%",height:"100%",opacity:0,fontSize:"99px",cursor:"pointer"}),t.css({position:"absolute",top:0,left:0,width:"100%",height:"100%",overflow:"hidden"}),d&&r.css({filter:"alpha(opacity=0)"}),r.on(h("change"),function(t){var a,u=t.target,l=[];u.value&&($("#form_"+s).css("top","-1048575px"),a=u.value.replace(/\\/g,"/"),a=a.substring(a.length,a.lastIndexOf("/")+1),l.push(new i.File(s,a)),e.features.triggerDialog&&o.off(h("click")),r.off(h("change")),n(),l.length&&e.trigger(i.EVENT_FILES_ADD,l))}),t.append(r),$(e.options.container||f).eq(0).append(t),e.refresh()}function r(){o=$('<iframe id="'+e.id+'_iframe" name="'+e.id+'_iframe" src="javascript:false;" style="display:none"></iframe>'),$(f).append(o),o.on(h("load"),function(){var t;if(a){try{t=$(this).contents().find("body").html()}catch(n){return void e.trigger(i.EVENT_ERROR,{code:i.ERROR_SECURITY,message:i.translate("Security error."),file:a})}try{t=$.parseJSON(t)}catch(n){}t&&(a.status=i.STATE_DONE,a.loaded=1025,a.percent=100,e.trigger(i.EVENT_FILE_UPLOAD_PROGRESS,a),e.trigger(i.EVENT_FILE_UPLOAD_COMPLETE,a,t))}})}var o,a,s,u,l,f=t.body,p=[],d=/MSIE/.test(navigator.userAgent),c=[],E=e.options.filters,h=function(e){return e+"."+s};e:for(var g=0;g<E.length;g++){var m=E[g].extensions.split(/,/);for(l=0;l<m.length;l++){if("*"===m[l]){c=[];break e}u=i.mimeTypes[m[l]],u&&-1===$.inArray(u,c)&&c.push(u)}}if(c=c.join(","),e.options.container){var _=$(e.options.container);"static"===_.css("position")&&_.css("position","relative")}e.on(i.EVENT_FILE_UPLOAD_START,function(t,n){var r,o;n.status!=i.STATE_DONE&&n.status!=i.STATE_FAILED&&e.state!=i.STATE_STOPPED&&(r=$("#form_"+n.id),o=$("#input_"+n.id),o.attr("name",e.options.file_data_name),r.attr("action",e.options.url),$.each($.extend({name:n.target_name||n.name},e.options.multipart_params),function(e,t){var i=$('<input type="hidden" name="'+e+'" value="'+t+'"/>');r.prepend(i)}),a=n,r.css("top","-1048575px"),r[0].submit())}),e.on(i.EVENT_FILE_UPLOAD_COMPLETE,function(){e.refresh()}),e.on(i.EVENT_FILES_REMOVE,function(e,t){var i,n;for(i=0;i<t.length;i++)n=$("#form_"+t[i].id),n.size()&&n.remove()}),e.on(i.EVENT_BROWSE_DISABLE,function(e,t){var i=$("#input_"+s);i.length&&i.prop("disabled",t)}),e.on(i.EVENT_START,function(){r(),$.each(e.files,function(e,t){if(t.status===i.STATE_DONE||t.status===i.STATE_FAILED){var n=$("#form_"+t.id);n.size()&&n.remove()}})}),e.on(i.EVENT_STOP,function(){setTimeout(function(){o.off(h("load")),o.size()&&o.remove()},0),$.each(e.files,function(e,t){if(t.status===i.STATE_DONE||t.status===i.STATE_FAILED){var n=$("#form_"+t.id);n.size()&&n.remove()}})}),e.on(i.EVENT_DISPOSE,function(){$.each(p,function(e,t){var i=$("#form_"+t);i.size()&&i.remove()})}),n()}),n({success:!0})}})}(window,document,lupload),+function(){lupload.addI18n({"File size error.":"上传的文件太大了~","File count error.":"上传的文件数量太多了~","File extension error.":"上传的文件格式不正确","Init error.":"可能暂时上传不了图片哦，请更换浏览器试试","Security error.":"可能暂时上传不了图片哦，请更换浏览器试试","HTTP Error.":"上传失败，是不是网络挂起了？"})}(lupload);