!function(t){"use strict";function i(i,e){this.element=t(i),this.options=t.extend({},g,e),this.options.text=this.element.find("["+r+"]").text()||"",this.options.dynamic="true"===this.element.attr(s)||""===this.element.attr(s)?!0:!1,this.options.enableRemove="true"===this.element.attr(d)||""===this.element.attr(d)?!0:!1,this.urls=[],this.imgs=[],this.options.dynamic||this.init()}function e(){var e=arguments[0],l=Array.prototype.slice.call(arguments,1);return this.each(function(){var a=t(this),n=a.attr(o),r=n?a.closest(n):a.parent(),s=r.data("ui.gallery");s||r.data("ui.gallery",s=new i(r[0])),"string"==typeof e&&s[e].apply(s,l)})}var l='[data-toggle= "gallery"]',a="data-gallery-url",n="data-gallery-lazy-src",o="data-gallery-parent",r="data-gallery-text",s="data-gallery-dynamic",d="data-gallery-enable-remove",g={direction:"horizontal",dynamic:!1},c='<div class="gallery-dialog"></div>',h='<div class="gallery-slide">   <ul class="gallery-content ui-slider-content" style="width: <%=urls.length%>00%;">       <% for(var i=0, len=urls.length; i<len; i++){ %>       <li><img class="gallery-img gallery-loading" '+n+'="<%= urls[i] %>"/></li>       <% } %>   </ul></div><% if( text ){ %><div class="gallery-text"><%= text %></div><% } %><div class="gallery-icon gallery-back"><i class="icon icon-left-open-big"></i></div><% if( remove ){ %><div class="gallery-icon gallery-remove"><i class="icon icon-trash-empty"></i></div><% } %>';i.prototype={init:function(){var i=[];this.element.find(l).each(function(){var e=t(this).attr(a);e&&i.push(e)});this.urls=i},show:function(i){var e=this;this.options.dynamic&&this.init(),e.indexing(i);var l=t.modal({layout:"blank",customClass:"modal-dark",html:c,show:!1});l.on("modal:show",function(){t(this);e.build(),e.bind(),e.load(e.index)}),l.on("modal:hide",function(){e.dialog=null}),this.dialog=l,l.modal("show")},hide:function(){},indexing:function(i){var e=0;if(i){var l=t(i).attr(a);l&&(e=t.inArray(l,this.urls))}this.index=e>=0?e:0},build:function(){this.imgs=this.dialog.find(".gallery-dialog").html(t.tpl(h,{urls:this.urls,text:this.options.text,remove:this.options.enableRemove})).find(".gallery-img")},bind:function(){var i=this;i.dialog.find(".gallery-back").on("tap",function(t){i.dialog.modal("hide"),t.stopPropagation()});var e=new fz.Scroll(i.dialog.find(".gallery-slide")[0],{role:"slider",indicator:!0,autoplay:!1,interval:3e3});if(e.moveTo(this.index),e.on("beforeScrollStart",function(t,e){i.load(e)}),i.options.enableRemove&&i.dialog.find(".gallery-remove").on("tap",function(l){t.confirm({content:"确定删除此图片?",buttons:[{text:"删除",type:"primary"},"取消"]}).on("modal:action",function(l){0===l.index&&(i.element.trigger(t.Event("gallery:remove"),e.currentPage),i.dialog.modal("hide"))}),l.stopPropagation()}),i.options.text){var l=i.dialog.find(".gallery-text");i.dialog.find(".gallery-slide").on("tap",function(){l.toggle()})}},load:function(i){var e=this,l=e.imgs.eq(i),a=l.attr(n);if(a&&"done"!=a){var o=new Image;t.loadingShow(),o.onload=function(){var i,e,r=document.documentElement.clientWidth,s=document.documentElement.clientHeight,d=o.width/r,g=o.height/s;1>=d&&1>=g?(i=o.width,e=o.height):d>g?(i="100%",e="auto"):(i="auto",e="100%"),l.css({width:i,height:e}).attr("src",a).attr(n,"done"),t.loadingHide()},o.onerror=function(){t.loadingHide()},o.src=a}}};var u=t.fn.gallery;t.fn.gallery=e,t.fn.gallery.Constructor=i,t.fn.gallery.noConflict=function(){return t.fn.gallery=u,this};var m=function(i){i.preventDefault(),e.call(t(this),"show",this)};t(document).on("tap.ui.gallery.data-api",'[data-toggle="gallery"]',m)}(Zepto);